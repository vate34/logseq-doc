# 影响数据库性能的因素
- 1. 数据量MySQL单库数据量在5000万以内性能比较好，超过阈值后性能会随着数据量的增大而变弱。MySQL单表的数据量是500w-1000w之间性能比较好，超过1000w性能也会下降。
- 2. 磁盘
- 3. 数据库连接
- # 拆分方式
- ## 垂直拆分
- 1. 垂直分库。将同一个系统中的不同业务进行拆分，不同的模块放到不同的库中。
- 2. 垂直分表。基于列字段，进行大表拆小表。可避免查询时数据量太大造成的“跨页”问题。
- ## 水平拆分
- 1. 水平分表。单表的数据量过大，根据一定的规则，将单表拆分为多张表。
- 2. 水平分库分表。将单表的数据切分到多个服务器上去，每个服务器具有相应的库与表，只是表中数据集合不同。
- # 常用的分库分表策略
- 1. Hash 取模
- 2. 范围取片
- 3. 地理位置分片
- 4. 时间分片
- # 分表分库后引入的问题
- ## 分布式事务问题
- 跨库执行SQL会涉及到分布式事务问题。解决的途径：
- 1. 使用分布式事务中间件。
- 2. 使用MySQL自带的针对跨库的事务一致性方案(XA)，不过性能要比单库的慢10倍左右。
- 3. 能否避免掉跨库操作(比如将用户和商品放在同一个库中)。
- ## 跨库 join 问题
- 分库分表后表之间的关联操作将受到限制，我们无法join位于不同分库的表，也无法join分表粒度不同的表， 结果原本一次查询能够完成的业务，可能需要多次查询才能完成。粗略的解决方法：
- 1. 全局表：基础数据，所有库都拷贝一份。
- 2. 字段冗余：这样有些字段就不用join去查询了。
- 3. 系统层组装：分别查询出所有，然后组装起来，较复杂。
- ## 结果集合并/排序的问题
- 因为我们是将数据分散存储到不同的库、表里的，当我们查询指定数据列表时，数据来源于不同的子库或者子表，就必然会引发结果集合并/排序的问题。如果每次查询都需要排序、合并等操作，性能肯定会受非常大的影响。走缓存可能是一条路。
- ## 横向扩容的 reHash 问题
- 当我们使用HASH取模做分表的时候，针对数据量的递增，可能需要动态的增加表，此时就需要考虑因为reHash导致数据迁移的问题。