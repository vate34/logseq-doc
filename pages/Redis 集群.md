- Redis有三种集群模式：
	- 主从复制模式
	- Sentinel（哨兵）模式
	- Cluster 模式
- ## 主从复制模式
	- **Redis 提供了复制（replication）功能，可以实现当一台数据库中的数据更新后，自动将更新的数据同步到其他数据库上**。
	- 在复制的概念中，数据库分为两类，一类是主数据库（master），另一类是从数据库(slave）。
		- **主数据库可以进行读写操作**，当写操作导致数据变化时会自动将数据同步给从数据库。
		- **从数据库一般是只读的**，并接受主数据库同步过来的数据。一个主数据库可以拥有多个从数据库，而一个从数据库只能拥有一个主数据库。
	- ### 作用
		- 读写分离，减轻主数据库的读写压力
		  logseq.order-list-type:: number
		- 方便做容灾备份
		  logseq.order-list-type:: number
	- ### 阶段
		- 建立连接、协商同步
		  logseq.order-list-type:: number
		- 主库将所有数据同步给从库。 这个过程依赖于内存快照生成的 RDB 文件。
		  logseq.order-list-type:: number
		- 主库会把上一阶段执行过程中收到的写命令，再发送给从库
		  logseq.order-list-type:: number
- ## 哨兵模式
	- 主从复制模式在主服务器宕机之后，需要手动切换主服务器，费事且会造成一段时间内服务不可用。
	- 哨兵模式是一种特殊的模式，首先 Redis 提供了哨兵的命令，**哨兵是一个独立的进程，作为进程，它会独立运行。其原理是哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个 Redis 实例**。
	- ## 作用
		- 通过发送命令，让 Redis 服务器返回监控其运行状态，包括主服务器和从服务器；
		- 当哨兵监测到 master 宕机，会自动将 slave 切换成 master ，然后通过**发布订阅模式**通知其他的从服务器，修改配置文件，让它们切换主机；
		- 然而一个哨兵进程对Redis服务器进行监控，也可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。
- ## Cluster 集群模式
	- Redis 的哨兵模式基本已经可以实现高可用，读写分离 ，但是在这种模式下每台 Redis 服务器都存储相同的数据，很浪费内存，所以在 redis3.0上加入了 Cluster 集群模式，实现了 Redis 的分布式存储，**也就是说每台 Redis 节点上存储不同的内容**。
	- ### 集群的数据分片
		- Redis 集群没有使用一致性 hash，而是引入了哈希槽【hash slot】的概念。Redis 集群有16384 个哈希槽，每个 key 通过 CRC16 校验后对 16384 取模来决定放置哪个槽。集群的每个节点负责一部分hash槽。
		- 这种结构很容易添加或者删除节点。比如如果我想新添加个节点 D ， 我需要从节点 A， B， C 中得部分槽到 D 上。如果我想移除节点 A ，需要将 A 中的槽移到 B 和 C 节点上，然后将没有任何槽的 A 节点从集群中移除即可。由于从一个节点将哈希槽移动到另一个节点并不会停止服务，所以无论添加删除或者改变某个节点的哈希槽的数量都不会造成集群不可用的状态。
	- ### 主从复制模型
		- 为了保证高可用，redis-cluster集群引入了主从复制模型，一个主节点对应一个或者多个从节点，当**主节点宕机的时候，就会启用从节点**。当其它主节点 ping 一个主节点 A 时，如果半数以上的主节点与 A 通信超时，那么认为主节点 A 宕机了。如果主节点 A 和它的从节点 A1 都宕机了，那么该集群就无法再提供服务了。