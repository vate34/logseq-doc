## 为什么选择 Kafka 作为消息队列
	- ### 功能丰富
		- Kafka 提供了丰富的功能，其特性包括消息堆积、可靠性、消息顺序性、幂等性和消息回溯等，可以很好的满足各种业务场景的需求。
		- 消息队列常用于以下两个业务场景：
			- 应用解耦。
			- 流量削峰。Kafka 可以处理大量的消息堆积，适用于流量削峰场景。
	- ### 高性能
		- 作为为大数据而生的消息队列，Kafka 在处理高吞吐量和大规模数据传输方面表现非凡，具有很高的性能表现。
	- ### 可靠性
		- Kafka 通过多副本机制保证消息的可靠性，包括生产者端、Broker 和消费者端，确保消息不丢失并提供高度的数据一致性。
			- **生产者**：三种ack策略来对应不同等级的可靠级别。
			- **broker**：当消息到达 Broker 时，首先会存储到 Page Cache，然后通过操作系统的刷盘机制将数据持久化到硬盘上。此外，在集群环境中，Kafka 还会通过数据同步机制，将数据同步到分布在多个节点的副本中，并保证它们的一致性。这些措施都提高了消息的可靠性。
			- **消费者**：可靠性通过消息的 Commit 机制来保证。与生产者端一样，Kafka 也提供了两种 Commit 策略供我们根据业务场景进行选择：
				- 手动 Commit：消费者在处理完消息后再提交，从而确保消息处理的可靠性。
				- 自动 Commit 则可以简化操作，但可能在某些情况下导致消息的重复处理或丢失。
	- ### 高可用性
		- Kafka 通过分区多副本机制提升容灾能力，即使集群中的某个 Broker 失效，系统仍然能够保持高可用性。
		- 简单来说，在集群环境下，Kafka 会为同一个分区（Partiton）内创建多个副本，并将这些副本分布在不同的 Broker 节点上。其中，这些副本又会分为处理所有的读写请求 Leader 副本、从 Leader 副本同步消息 Follower 副本，它们最终会在集群中形成一主多从的关系。
- ## Kafka 发送一条消息的流程
	- 发送主要涉及两个流程：消息在生产者客户端发送的流程，消息到达 broker后，broker对消息的处理流程。
	- ### 生产者发送流程
		- 当我们使用 Kafka 客户端发送消息时，表面上我们只是调用了一个方法，但是背后是一条复杂的消息推送流程。
		- 这个流程由包括生产者 KafkaProducer、生产者拦截器 ProducerInterceptor、序列化 Serializer、分区器 Partitioner、消息累加器 RecordAccumulator 和消息发送线程 Sender 在内的多个核心组件共同完成。
	- ### broker 处理流程
		- 消息到达 Broker 后，其处理流程会根据生产者中 `acks` 的配置而异。生产者的 `acks` 配置有三种策略，具体如下：
			- **acks=0**：无需等待生产者发送数据在 Broker 落盘即返回响应，**该方案可靠性较差，但效率高**。
			- **acks=1**：需要等待 Leader 副本收到数据后返回响应，**该方案可靠性一般，效率一般**。
			- **acks=-1 或 all**：需要等待 Leader 和 ISR（In-Sync-Replica）集合中的所有节点对齐数据后返回响应，**该方案可靠性高，但效率低**。
		- 在默认情况下，Kafka 的 `acks` 参数为 1，也就是默认使用第二种策略，在可靠性和效率方面较为均衡。